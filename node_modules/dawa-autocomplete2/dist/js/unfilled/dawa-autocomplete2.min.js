!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).dawaAutocomplete={})}(this,function(e){"use strict";var t,n,r=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={default:"__default"},r=Object.prototype.hasOwnProperty;function s(){}function o(){return new s}function i(e,t){for(;e.length>t;)e.pop()}function u(e,t,n){if(null==n)e.removeAttribute(t);else{var r=function(e){return 0===e.lastIndexOf("xml:",0)?"http://www.w3.org/XML/1998/namespace":0===e.lastIndexOf("xlink:",0)?"http://www.w3.org/1999/xlink":void 0}(t);r?e.setAttributeNS(r,t,String(n)):e.setAttribute(t,String(n))}}function a(e,t,n){e[t]=n}function l(e,t,n){t.indexOf("-")>=0?e.setProperty(t,n):e[t]=n}s.prototype=Object.create(null);var c=o();function f(e,t,r){(c[t]||c[n.default])(e,t,r)}c[n.default]=function(e,t,n){var r=typeof n;"object"===r||"function"===r?a(e,t,n):u(e,t,n)},c.style=function(e,t,n){if("string"==typeof n)e.style.cssText=n;else{e.style.cssText="";var s=e.style;for(var o in n)i=n,u=o,r.call(i,u)&&l(s,o,n[o])}var i,u};var d={nodesCreated:null,nodesDeleted:null},p=function(){function e(){this.created=[],this.deleted=[]}return e.prototype.markCreated=function(e){this.created.push(e)},e.prototype.markDeleted=function(e){this.deleted.push(e)},e.prototype.notifyChanges=function(){d.nodesCreated&&this.created.length>0&&d.nodesCreated(this.created),d.nodesDeleted&&this.deleted.length>0&&d.nodesDeleted(this.deleted)},e}();function h(e){return 1===e.nodeType}var v=Node.prototype.getRootNode||function(){for(var e=this,t=e;e;)t=e,e=e.parentNode;return t};function g(e,t){var n=function(e){var t=v.call(e);return function(e){return 11===e.nodeType||9===e.nodeType}(t)?t.activeElement:null}(e);return n&&e.contains(n)?function(e,t){for(var n=[],r=e;r!==t;){var s=r;n.push(s),r=s.parentNode}return n}(n,t):[]}var m=function(){function e(e,t,n){this._attrsArr=null,this.staticsApplied=!1,this.nameOrCtor=e,this.key=t,this.text=n}return e.prototype.hasEmptyAttrsArr=function(){var e=this._attrsArr;return!e||!e.length},e.prototype.getAttrsArr=function(e){return this._attrsArr||(this._attrsArr=new Array(e))},e}();function y(e,t,n,r){var s=new m(t,n,r);return e.__incrementalDOMData=s,s}function b(e,t){return k(e,t)}function k(e,t){if(e.__incrementalDOMData)return e.__incrementalDOMData;var n=h(e)?e.localName:e.nodeName,r=h(e)?e.getAttribute("key")||t:null,s=y(e,n,r,function(e){return 3===e.nodeType}(e)?e.data:void 0);return h(e)&&function(e,t){var n=e.attributes,r=n.length;if(!r)return;for(var s=t.getAttrsArr(r),o=0,i=0;o<r;o+=1,i+=2){var u=n[o],a=u.name,l=u.value;s[i]=a,s[i+1]=l}}(e,s),s}function C(e,t,n,r){var s;if("function"==typeof n)s=new n;else{var o=function(e,t){return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/Math/MathML":null==t?null:"foreignObject"===b(t).nameOrCtor?null:t.namespaceURI}(n,t);s=o?e.createElementNS(o,n):e.createElement(n)}return y(s,n,r),s}var x=null,w=null,R=null,_=null,A=[],O=[];function q(){return O}function S(e){return function(t,n,r){var s=x,o=_,i=A,u=O,a=w,l=R;x=new p,_=t.ownerDocument,O=[],R=t.parentNode,A=g(t,R);try{return e(t,n,r)}finally{_=o,O=u,w=a,R=l,A=i,x.notifyChanges(),x=s}}}var D=S(function(e,t,n){return w=e,N(),t(n),z(),e}),E=S(function(e,t,n){var r={nextSibling:e};return w=r,t(n),R&&j(R,P(),e.nextSibling),r===w?null:w});function I(e,t,n){var r=b(e,n);return t==r.nameOrCtor&&n==r.key}function L(e,t){var n;return n="#text"===e?function(e){var t=e.createTextNode("");return y(t,"#text",null),t}(_):C(_,R,e,t),x.markCreated(n),n}function T(e,t){var n=function(e,t,n){if(!e)return null;if(I(e,t,n))return e;if(n)for(;e=e.nextSibling;)if(I(e,t,n))return e;return null}(w,e,t)||L(e,t);n!==w&&(A.indexOf(n)>=0?function(e,t,n){for(var r=t.nextSibling,s=n;null!==s&&s!==t;){var o=s.nextSibling;e.insertBefore(s,r),s=o}}(R,n,w):R.insertBefore(n,w),w=n)}function j(e,t,n){for(var r=e,s=t;s!==n;){var o=s.nextSibling;r.removeChild(s),x.markDeleted(s),s=o}}function N(){R=w,w=null}function P(){return w?w.nextSibling:R.firstChild}function M(){w=P()}function z(){j(R,P(),null),w=R,R=R.parentNode}function U(e,t){return M(),T(e,t),N(),R}function B(){return z(),w}var F=3,H=o();function K(e,t,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];var o=U(e,t),u=b(o);u.staticsApplied||function(e,t,n){if(t.staticsApplied=!0,n&&n.length)if(t.hasEmptyAttrsArr())for(var r=0;r<n.length;r+=2)f(e,n[r],n[r+1]);else{for(r=0;r<n.length;r+=2)H[n[r]]=r+1;var s=t.getAttrsArr(0),o=0;for(r=0;r<s.length;r+=2){var u=s[r],a=s[r+1],l=H[u];l?n[l]===a&&delete H[u]:(s[o]=u,s[o+1]=a,o+=2)}for(var u in i(s,o),H)f(e,u,n[H[u]]),delete H[u]}}(o,u,n);var a=Math.max(0,arguments.length-F),l=u.hasEmptyAttrsArr();if(!a&&l)return o;for(var c=u.getAttrsArr(a),d=F,p=0;d<arguments.length;d+=2,p+=2){var h=arguments[d];if(l)c[p]=h;else if(c[p]!==h)break;var v=arguments[d+1];(l||c[p+1]!==v)&&(c[p+1]=v,f(o,h,v))}if(d<arguments.length||p<c.length){for(var g=p;p<c.length;p+=2)H[c[p]]=c[p+1];for(p=g;d<arguments.length;d+=2,p+=2){h=arguments[d],v=arguments[d+1];H[h]!==v&&f(o,h,v),c[p]=h,c[p+1]=v,delete H[h]}for(var h in i(c,p),H)f(o,h,void 0),delete H[h]}return o}function V(e){return B()}t.applyAttr=u,t.applyProp=a,t.attributes=c,t.close=B,t.currentElement=function(){return R},t.currentPointer=function(){return P()},t.open=U,t.patch=D,t.patchInner=D,t.patchOuter=E,t.skip=function(){w=R.lastChild},t.skipNode=M,t.getKey=function(e){return e.__incrementalDOMData,b(e).key},t.clearCache=function e(t){t.__incrementalDOMData=null;for(var n=t.firstChild;n;n=n.nextSibling)e(n)},t.importNode=function e(t){k(t);for(var n=t.firstChild;n;n=n.nextSibling)e(n)},t.isDataInitialized=function(e){return Boolean(e.__incrementalDOMData)},t.notifications=d,t.symbols=n,t.attr=function(e,t){var n=q();n.push(e),n.push(t)},t.elementClose=V,t.elementOpen=K,t.elementOpenEnd=function(){var e=q(),t=K.apply(null,e);return i(e,0),t},t.elementOpenStart=function(e,t,n){var r=q();r[0]=e,r[1]=t,r[2]=n},t.elementVoid=function(e,t,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];return K.apply(null,arguments),V()},t.text=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=(M(),T("#text",null),w),s=b(r);if(s.text!==e){s.text=e;for(var o=e,i=1;i<arguments.length;i+=1)o=(0,arguments[i])(o);r.data=o}return r},t.key=function(e){q()[1]=e}}(t={exports:{}},t.exports),t.exports);(n=r)&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")&&n.default;r.applyAttr;var s=r.applyProp,o=r.attributes,i=(r.close,r.currentElement,r.currentPointer,r.open,r.patch),u=(r.patchInner,r.patchOuter,r.skip,r.skipNode,r.getKey,r.clearCache,r.importNode,r.isDataInitialized,r.notifications,r.symbols,r.attr,r.elementClose),a=r.elementOpen,l=(r.elementOpenEnd,r.elementOpenStart,r.elementVoid),c=r.text;r.key;o.caretpos=function(e,t,n){e.setSelectionRange(n,n)},o.value=s;var f=function(e,t,n,r){i(e,function(){!function(e,t,n){if(e.suggestions.length>0&&e.focused){a("ul","",["class","dawa-autocomplete-suggestions","role","listbox","unselectable","on"]);for(var r=function(r){var s=e.suggestions[r],o="dawa-autocomplete-suggestion";e.selected===r&&(o+=" dawa-selected"),a("li","",["role","option"],"class",o,"onmousedown",function(e){t(r),e.preventDefault()});var i=s.forslagstekst.split("\n");if(i=i.map(function(e){return e.replace(/ /g,"Â ")}),n){c(i[0]);for(var f=1;f<i.length;++f)l("br"),c(i[f])}else c(i.join(", "));u("li")},s=0;s<e.suggestions.length;++s)r(s);u("ul")}}(t,n,r)})},d=function(e,t){var n=t.onSelect,r=t.onTextChange,s=t.render||f,o=!1,u="",a=0,l=document.createElement("div");e.parentNode.insertBefore(l,e.nextSibling);var c,d={caretpos:2,inputText:"",selected:0,focused:document.activeElement===e,suggestions:[]},p=function(e){var t=e.value,n=e.selectionStart;d.caretpos=n,d.inputText=t,function(e,t){u===e&&a===t||(r(e,t),u=e,a=t)}(t,n)},h=function(e){var t=d.suggestions[e];d.inputText=t.tekst,d.caretpos=t.caretpos,d.suggestions=[],n(t),c(!0)},v=function(e){var t=window.event?e.keyCode:e.which;if(d.suggestions.length>0&&d.focused){if(40===t)d.selected=(d.selected+1)%d.suggestions.length,c();else if(38===t)d.selected=(d.selected-1+d.suggestions.length)%d.suggestions.length,c();else{if(13!==t&&9!==t)return!0;h(d.selected)}return e.preventDefault(),!1}},g=function(){d.focused=!0,c()},m=function(){return d.focused=!1,c(),!1},y=function(e){p(e.target)},b=function(e){return p(e.target)},k=!1,C=!1;(c=function(n){n&&(C=!0),k||(k=!0,requestAnimationFrame(function(){o||(k=!1,C&&(e.value=d.inputText,e.setSelectionRange(d.caretpos,d.caretpos)),C=!1,s(l,d,function(e){return h(e)},t.multiline))}))})();return e.addEventListener("keydown",v),e.addEventListener("blur",m),e.addEventListener("focus",g),e.addEventListener("input",y),e.addEventListener("mouseup",b),e.setAttribute("aria-autocomplete","list"),e.setAttribute("autocomplete","off"),{destroy:function(){o=!0,e.removeEventListener("keydown",v),e.removeEventListener("blur",m),e.removeEventListener("focus",g),e.removeEventListener("input",y),e.removeEventListener("mouseup",b),i(l,function(){}),l.remove()},setSuggestions:function(e){d.suggestions=e,d.selected=0,c()},selectAndClose:function(e){d.inputText=e,d.caretpos=e.length,d.suggestions=[],d.selected=0,c(!0)}}};function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h={params:{},minLength:2,retryDelay:500,renderCallback:function(){console.error("No renderCallback supplied")},initialRenderCallback:function(){console.error("No initialRenderCallback supplied")},type:"adresse",baseUrl:"https://dawa.aws.dk",adgangsadresserOnly:!1,stormodtagerpostnumre:!0,supplerendebynavn:!0,fuzzy:!0,fetchImpl:function(e,t){return(n="".concat(e,"?").concat(function(e){return Object.keys(e).map(function(t){var n=e[t];return"".concat(t,"=").concat(encodeURIComponent(n))}).join("&")}(t)),r={mode:"cors"},r=r||{},new Promise(function(e,t){var s=new XMLHttpRequest,o=[],i=[],u={},a=function(){return{ok:2==(s.status/100|0),statusText:s.statusText,status:s.status,url:s.responseURL,text:function(){return Promise.resolve(s.responseText)},json:function(){return Promise.resolve(JSON.parse(s.responseText))},blob:function(){return Promise.resolve(new Blob([s.response]))},clone:a,headers:{keys:function(){return o},entries:function(){return i},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var l in s.open(r.method||"get",n,!0),s.onload=function(){s.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){o.push(t=t.toLowerCase()),i.push([t,n]),u[t]=u[t]?u[t]+","+n:n}),e(a())},s.onerror=t,s.withCredentials="include"==r.credentials,r.headers)s.setRequestHeader(l,r.headers[l]);s.send(r.body||null)})).then(function(e){return e.json()});var n,r}},v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({},h,t||{}),this.options=t,this.state={currentRequest:null,pendingRequest:null},this.selected=null}var t,n,r;return t=e,(n=[{key:"_getAutocompleteResponse",value:function(e,t,n,r,s,o){var i=Object.assign({},this.options.params,{q:e,type:this.options.type,caretpos:t,supplerendebynavn:s,stormodtagerpostnumre:o,multilinje:!0});return this.options.fuzzy&&(i.fuzzy=""),r&&(i.adgangsadresseid=r),n&&(i.startfra="adgangsadresse"),this.options.fetchImpl("".concat(this.options.baseUrl,"/autocomplete"),i)}},{key:"_scheduleRequest",value:function(e){null!==this.state.currentRequest?this.state.pendingRequest=e:(this.state.currentRequest=e,this._executeRequest())}},{key:"_executeRequest",value:function(){var e,t,n=this,r=this.state.currentRequest,s=null,o=!1;if(r.selected){var i=r.selected;if(i.type===this.options.type)return this.options.selectCallback(i),this.selected=i,void this._requestCompleted();s="adgangsadresse"===i.type?i.data.id:null,o="vejnavn"===i.type,e=i.tekst,t=i.caretpos}else e=r.text,t=r.caretpos;if(r.selectedId){var u={id:r.selectedId,type:this.options.type};return this.options.fetchImpl("".concat(this.options.baseUrl,"/autocomplete"),u).then(function(e){return n._handleResponse(r,e)},function(e){return n._handleFailedRequest(r,e)})}r.selected||r.text.length>=this.options.minLength?this._getAutocompleteResponse(e,t,o,s,this.options.supplerendebynavn,this.options.stormodtagerpostnumre).then(function(e){return n._handleResponse(r,e)},function(e){return n._handleFailedRequest(r,e)}):this._handleResponse(r,[])}},{key:"_handleFailedRequest",value:function(e,t){var n,r=this;return console.error("DAWA request failed",t),(n=this.options.retryDelay,new Promise(function(e){return setTimeout(e,n)})).then(function(){r.state.pendingRequest||r._scheduleRequest(e),r._requestCompleted()})}},{key:"_handleResponse",value:function(e,t){if(e.selected)if(1===t.length){var n=t[0];n.type===this.options.type?this.options.selectCallback(n):this.state.pendingRequest||(this.state.pendingRequest={selected:n})}else this.options.renderCallback&&this.options.renderCallback(t);else e.selectedId?1===t.length&&(this.selected=t[0],this.options.initialRenderCallback(t[0].tekst)):this.options.renderCallback&&this.options.renderCallback(t);this._requestCompleted()}},{key:"_requestCompleted",value:function(){this.state.currentRequest=this.state.pendingRequest,this.state.pendingRequest=null,this.state.currentRequest&&this._executeRequest()}},{key:"setRenderCallback",value:function(e){this.options.renderCallback=e}},{key:"setInitialRenderCallback",value:function(e){this.options.initialRenderCallback=e}},{key:"setSelectCallback",value:function(e){this.options.selectCallback=e}},{key:"update",value:function(e,t){var n={text:e,caretpos:t};this._scheduleRequest(n)}},{key:"select",value:function(e){var t={selected:e};this._scheduleRequest(t)}},{key:"selectInitial",value:function(e){var t={selectedId:e};this._scheduleRequest(t)}},{key:"destroy",value:function(){}}])&&p(t.prototype,n),r&&p(t,r),e}();e.dawaAutocomplete=function(e,t){t=Object.assign({select:function(){return null}},t);var n=["baseUrl","minLength","params","fuzzy","stormodtagerpostnumre","supplerendebynavn","type"].reduce(function(e,n){return t.hasOwnProperty(n)&&(e[n]=t[n]),e},{});n.type||(t.adgangsadresserOnly?n.type="adgangsadresse":n.type="adresse");var r=new v(n),s=d(e,{onSelect:function(e){r.select(e)},onTextChange:function(e,t){r.update(e,t)},render:t.render,multiline:t.multiline||!1});return r.setRenderCallback(function(e){return s.setSuggestions(e)}),r.setSelectCallback(function(e){s.selectAndClose(e.tekst),t.select(e)}),r.setInitialRenderCallback(function(e){return s.selectAndClose(e)}),t.id&&r.selectInitial(t.id),{id:function(e){return r.selectInitial(e)},destroy:function(){return s.destroy()},selected:function(){return r.selected}}},Object.defineProperty(e,"__esModule",{value:!0})});
